FROM python:3.8

ARG CALIBRATE_START_LAMBDA_FUNCTION_URL
ARG CHARGE_START_LAMBDA_FUNCTION_URL
ARG CHARGE_PROGRESS_LAMBDA_FUNCTION_URL
ARG PERFORM_REGISTRATION_LAMBDA_FUNCTION_URL
ARG CALCULATE_AVOIDED_EMISSIONS_LAMBDA_FUNCTION_URL

COPY . /app
WORKDIR /app

RUN sed -i "s/<<CALIBRATE_START_LAMBDA_FUNCTION_URL>>/${CALIBRATE_START_LAMBDA_FUNCTION_URL}/g" app.py
RUN sed -i "s/<<CHARGE_START_LAMBDA_FUNCTION_URL>>/${CHARGE_START_LAMBDA_FUNCTION_URL}/g" app.py
RUN sed -i "s/<<CHARGE_PROGRESS_LAMBDA_FUNCTION_URL>>/${CHARGE_PROGRESS_LAMBDA_FUNCTION_URL}/g" app.py
RUN sed -i "s/<<PERFORM_REGISTRATION_LAMBDA_FUNCTION_URL>>/${PERFORM_REGISTRATION_LAMBDA_FUNCTION_URL}/g" app.py
RUN sed -i "s/<<CALCULATE_AVOIDED_EMISSIONS_LAMBDA_FUNCTION_URL>>/${CALCULATE_AVOIDED_EMISSIONS_LAMBDA_FUNCTION_URL}/g" app.py

RUN cat app.py

RUN pip install -r requirements.txt
ENTRYPOINT ["python"]
CMD ["app.py"]
